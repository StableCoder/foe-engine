# Global

stages:
 - Platform Tests

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  CTEST_OUTPUT_ON_FAILURE: 1

# Platforms

.platform_unix_template: &platform_unix_template
  stage: Platform Tests
  tags: 
    - docker-linux
    - amd64
  dependencies: []
  script:
    - mkdir build && cd build
    - cmake .. -GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=ON ${CMAKE_OPTIONS}
    - ninja
    - ninja test

Fedora/GCC Static:
  image: stabletec/build-foe:fedora
  variables:
    CC: gcc
    CXX: g++
  <<: *platform_unix_template

Fedora/GCC Shared:
  image: stabletec/build-foe:fedora
  variables:
    CC: gcc
    CXX: g++
    CMAKE_OPTIONS: -DBUILD_SHARED_LIBS=ON
  <<: *platform_unix_template

Fedora/Clang Static:
  image: stabletec/build-foe:fedora
  variables:
    CC: clang
    CXX: clang++
  <<: *platform_unix_template

Fedora/Clang Shared:
  image: stabletec/build-foe:fedora
  variables:
    CC: clang
    CXX: clang++
    CMAKE_OPTIONS: -DBUILD_SHARED_LIBS=ON
  <<: *platform_unix_template

Ubuntu/GCC Static:
  image: stabletec/build-foe:ubuntu
  variables:
    CC: gcc
    CXX: g++
  <<: *platform_unix_template

Ubuntu/GCC Shared:
  image: stabletec/build-foe:ubuntu
  variables:
    CC: gcc
    CXX: g++
    CMAKE_OPTIONS: -DBUILD_SHARED_LIBS=ON
  <<: *platform_unix_template

Ubuntu/Clang Static:
  image: stabletec/build-foe:ubuntu
  variables:
    CC: clang
    CXX: clang++
  <<: *platform_unix_template

Ubuntu/Clang Shared:
  image: stabletec/build-foe:ubuntu
  variables:
    CC: clang
    CXX: clang++
    CMAKE_OPTIONS: -DBUILD_SHARED_LIBS=ON
  <<: *platform_unix_template


.platform_windows_template: &platform_windows_template
  stage: Platform Tests
  image: stabletec/build-foe:windows
  tags:
    - docker-windows
    - amd64
  dependencies: []
  script:
    - mkdir build; cd build
    - cmake .. -GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=ON $env:CMAKE_OPTIONS
    - ninja
    - ninja test

Windows/MSVC Static:
  variables:
  <<: *platform_windows_template

Windows/MSVC Shared:
  variables:
    CMAKE_OPTIONS: -DBUILD_SHARED_LIBS=ON
  <<: *platform_windows_template

Windows/Clang-cl Static:
  variables:
    CC: clang-cl
    CXX: clang-cl
  <<: *platform_windows_template

Windows/Clang-cl Shared:
  variables:
    CC: clang-cl
    CXX: clang-cl
    CMAKE_OPTIONS: -DBUILD_SHARED_LIBS=ON
  <<: *platform_windows_template

